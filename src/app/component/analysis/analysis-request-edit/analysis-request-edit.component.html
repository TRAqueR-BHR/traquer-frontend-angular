<p-panel *ngIf="patientPanelShouldAppear"
     header="Sélection du patient"
    [toggleable]="true"
    [(collapsed)]="patientSeachPanelCollapsed">

    <app-patient-search></app-patient-search>

</p-panel>

<p-panel *ngIf="analysisRequest"
    header="Détails de la demande d'analyse"
    [toggleable]="true"
    [collapsed]="analysisRequestPanelCollapsed">

    <ng-container *ngIf="analysisRequest != null">

        <form name="form" #analysisRequestForm="ngForm" class="ui-g"
            (ngSubmit)="analysisRequestForm.form.valid && save()">

            <div class="custom-form-grid p-fluid">

                <div class="custom-form-field col-12 flex align-items-center font-bold">
                    <span>{{'patient'|getTranslation}} {{patientDecrypt.firstname}} {{patientDecrypt.lastname}}</span>
                </div>

                <div class="custom-form-field col-12 md:col-6">
                    <label for="unit"
                        class="custom-label"
                        i18n="@@unit_where_to_collect_sample">
                        UF où faire le prélevement
                    </label>
                    <app-processing-anim [withText]="true"
                        *ngIf="loadingUnits"></app-processing-anim>

                    <p-dropdown [options]="optionsPatientUnits"
                        id="unit"
                        name="unit"
                        appendTo="body"
                        [(ngModel)]="analysisRequest.unit"
                        [filter]="true"
                        required></p-dropdown>
                </div>

                <div class="custom-form-field col-12 md:col-6">
                    <label for="requestType"
                        class="custom-label"
                        i18n="@@request_type">
                        Type d'analyse</label>

                    <p-dropdown [options]="optionsANALYSIS_REQUEST_TYPE"
                        id="requestType"
                        name="requestType"
                        appendTo="body"
                        [(ngModel)]="analysisRequest.requestType"
                        required></p-dropdown>
                </div>

                <div class="custom-form-field col-12 md:col-6">
                    <label for="requestTime"
                        class="custom-label"
                        i18n="@@analysis_request_time">
                        Date de la demande d'analyse</label>
                    <p-calendar id="requestTime"
                        name="requestTime"
                        [showTime]="true"
                        appendTo="body"
                        [showIcon]="true"
                        dateFormat="dd/mm/yy"
                        [(ngModel)]="analysisRequest.requestTime"
                        required
                    ></p-calendar>
                </div>

                <div class="custom-form-field col-12 md:col-6">
                    <label for="unitExpectedCollectionTime"
                        class="custom-label"
                        i18n="@@unit_expected_collection_time">
                        Date attendue de prélèvement par l'UF</label>
                    <p-calendar id="unitExpectedCollectionTime"
                        name="unitExpectedCollectionTime"
                        [showTime]="true"
                        appendTo="body"
                        [showIcon]="true"
                        dateFormat="dd/mm/yy"
                        [(ngModel)]="analysisRequest.unitExpectedCollectionTime"
                        required
                    ></p-calendar>
                </div>

                <div class="custom-form-field col-12">

                    <button pButton type="submit"
                        [disabled]="analysisRequestForm.invalid || processing"
                        i18n-label="save"
                        label="Enregistrer"
                        class="mt-2 w-auto">
                    </button>

                </div>

            </div>

        </form>

    </ng-container>


</p-panel>
