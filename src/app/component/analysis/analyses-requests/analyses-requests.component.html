<p-table [columns]="queryParams.cols" [value]="data"
    [lazy]="true" [lazyLoadOnInit]="false" (onLazyLoad)="updateSorting($event)"
    [paginator]="true" paginatorPosition="both"
    sortMode="multiple"  [scrollable]="true" scrollHeight="75vh"
    [rows]="queryParams.pageSize" [totalRecords]="totalRecords" [loading]="loading"
    styleClass="table_with_centered_content with-infinite-paginator">

    <!-- Columns selection and download -->
    <ng-template pTemplate="caption">

        <div class="flex">

            <p-multiSelect [options]="selectableColumns"
                [(ngModel)]="selectedColumns"
                selectedItemsLabel="{0} colonnes sélectionnées"
                [style]="{minWidth: '200px'}"
                defaultLabel="Choisir les colonnes à afficher"
                (ngModelChange)="updateColumnsSelection($event)">
            </p-multiSelect>
        </div>

    </ng-template>

    <ng-template pTemplate="header" let-columns>

        <!-- Names and sorting -->
        <tr>
            <ng-container *ngFor="let col of columns" >
                <ng-container *ngIf="col.columnIsDisplayed" >
                    <th *ngIf="col.sortable" [pSortableColumn]="col.field">
                        {{col.header}}
                        <p-sortIcon *ngIf="col.sortable" [field]="col.field"></p-sortIcon>
                    </th>
                    <th *ngIf="!col.sortable">
                        {{col.header}}
                    </th>
                </ng-container>
            </ng-container>
        </tr>

        <!-- Filters -->
        <tr>
            <ng-container *ngFor="let col of columns" >
                <ng-container *ngIf="col.columnIsDisplayed" >
                    <th *ngIf="col.filterable" [ngSwitch]="true">
                        <p-multiSelect *ngSwitchCase="col.field === 'request_type'"
                            [options]="optionsANALYSIS_REQUEST_TYPE"
                            appendTo="body"
                            [(ngModel)]="filterValues[col.field]"
                            filterPlaceholder="qq"
                            (onChange)="updateFiltering()"
                            ></p-multiSelect>
                        <p-multiSelect *ngSwitchCase="col.field === 'request_status'"
                            [options]="optionsANALYSIS_REQUEST_STATUS_TYPE"
                            appendTo="body"
                            [(ngModel)]="filterValues[col.field]"
                            filterPlaceholder="qq"
                            (onChange)="updateFiltering()"
                            ></p-multiSelect>
                        <p-multiSelect *ngSwitchCase="col.field === 'sample_material_type'"
                            [options]="optionsSAMPLE_MATERIAL_TYPE"
                            appendTo="body"
                            [(ngModel)]="filterValues[col.field]"
                            filterPlaceholder="qq"
                            (onChange)="updateFiltering()"></p-multiSelect>
                        <p-calendar *ngSwitchCase="col.field === 'request_time'"
                            [showTime]="false"  [showButtonBar]="true"
                            dateFormat="dd/mm/yy"
                            [monthNavigator]="true" [yearNavigator]="true" yearRange="2000:2030"
                            (onSelect)="updateFiltering()" (onClearClick)="updateFiltering()"
                            appendTo="body" [locale]="translationForPrimengCalendar"
                            [(ngModel)]="filterValues[col.field]"
                            ></p-calendar>
                        <p-dropdown *ngSwitchCase="col.field === 'result'"
                            [options]="optionsANALYSIS_RESULT_VALUE_TYPE"
                            appendTo="body"
                            [(ngModel)]="filterValues[col.field]"
                            filterPlaceholder="qq"
                            (onChange)="updateFiltering()"></p-dropdown>
                        <p-calendar *ngSwitchCase="col.field === 'birthdate'" type="date"
                            [showTime]="false" [showIcon]="true"
                            dateFormat="dd/mm/yy" appendTo="body"
                            [showButtonBar]="true"
                            [(ngModel)]="filterValues[col.field]"
                            (ngModelChange)="updateFiltering()"></p-calendar>
                        <input *ngSwitchDefault pInputText type="text"
                            [(ngModel)]="filterValues[col.field]"
                            (keyup)="updateFiltering()">


                    </th>
                    <th *ngIf="!col.filterable" ></th>
                </ng-container>
            </ng-container>
        </tr>
    </ng-template>
    <!-- Values -->
    <ng-template pTemplate="body" let-rowData let-columns="columns">
        <tr [pSelectableRow]="rowData">
            <ng-container  *ngFor="let col of columns" >
                <ng-container *ngIf="col.columnIsDisplayed" >
                    <td [ngSwitch]="col.field">
                        <span *ngSwitchDefault>{{rowData[col.nameInSelect]}}</span>
                        <div  *ngSwitchCase="'lastname'"
                            class="flex align-content-center">
                            <span class="flex align-items-center justify-content-center">
                                {{rowData[col.nameInSelect] | getTranslation}}
                            </span>
                            <button  pButton pRipple type="button"
                                (click)="showInfectiousStatusExplanation(rowData)"
                                icon="fas fa-info"
                                class="p-button-rounded p-button-text p-button-sm"></button>
                        </div>
                        <span *ngSwitchCase="'request_type'">
                            {{
                                rowData[col.nameInSelect] |
                                getTranslation
                            }}
                        </span>
                        <span *ngSwitchCase="'request_status'">
                            {{
                                rowData[col.nameInSelect] |
                                concatBefore:'ANALYSIS_REQUEST_STATUS_TYPE_' |
                                getTranslation
                            }}
                        </span>
                        <span *ngSwitchCase="'request_time'">{{rowData[col.nameInSelect] | date:'dd/MM/yyyy HH:mm'}}</span>
                        <span *ngSwitchCase="'result_time'">{{rowData[col.nameInSelect] | date:'dd/MM/yyyy HH:mm'}}</span>
                        <span *ngSwitchCase="'birthdate'">{{rowData[col.nameInSelect] | date:'dd/MM/yyyy'}}</span>


                    </td>
                </ng-container>
            </ng-container>
        </tr>
    </ng-template>

</p-table>
