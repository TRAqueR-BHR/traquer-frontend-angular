<p-table [columns]="queryParams.cols" [value]="data" 
    [lazy]="true" [lazyLoadOnInit]="false" (onLazyLoad)="updateSorting($event)" 
    [paginator]="true" paginatorPosition="both"
    sortMode="multiple"  [scrollable]="true" scrollHeight="75vh"
    [rows]="queryParams.pageSize" [totalRecords]="totalRecords" [loading]="loading" 
    styleClass="table_with_centered_content with-infinite-paginator">   

    <!-- Columns selection and download -->
    <ng-template pTemplate="caption">
        <div style="text-align:left">
            <p-multiSelect [options]="selectableColumns" [(ngModel)]="selectedColumns" 
                        selectedItemsLabel="{0} colonnes sélectionnées" [style]="{minWidth: '200px'}" 
                        defaultLabel="Choisir les colonnes à afficher" (ngModelChange)="updateColumnsSelection($event)"></p-multiSelect>
            
            <div class="p-d-flex float-right">
                <div class="p-mr-0">
                    <p-button *ngIf="canDisplayDownloadCSVButton" label="Export .csv"
                        icon="fas fa-download" (click)="exportCSV()"></p-button>
                </div>
            </div>    

        </div>
    </ng-template>

    <!-- Columns sizes -->
    <!-- <ng-template pTemplate="colgroup" let-columns>
        <colgroup>
            <ng-container *ngFor="let col of columns" >
                <ng-container *ngIf="col.columnIsDisplayed" [ngSwitch]="col.field">
                    <col *ngSwitchDefault [ngStyle]="{'width': col.width}"/>
                </ng-container>                
            </ng-container>                            
        </colgroup>
    </ng-template> -->

    <ng-template pTemplate="header" let-columns>

        <!-- Names and sorting -->
        <tr>
            <ng-container *ngFor="let col of columns" >
                <ng-container *ngIf="col.columnIsDisplayed" >
                    <th *ngIf="col.sortable" [pSortableColumn]="col.field">
                        {{col.header}}
                        <p-sortIcon *ngIf="col.sortable" [field]="col.field"></p-sortIcon>
                    </th>    
                    <th *ngIf="!col.sortable">
                        {{col.header}}
                    </th>    
                </ng-container>                
            </ng-container>            
        </tr>

        <!-- Filters -->
        <tr>
            <ng-container *ngFor="let col of columns" >
                <ng-container *ngIf="col.columnIsDisplayed" >
                    <th *ngIf="col.filterable" [ngSwitch]="true">                                                                              
                        <input *ngSwitchDefault pInputText type="text" 
                            [(ngModel)]="filterValues[col.field]"
                            (keyup)="updateFiltering()"> 
                        <p-dropdown *ngSwitchCase="col.field === 'carrier_contact'" 
                            [options]="carrierContactSelectItems" appendTo="body"
                            [(ngModel)]="filterValues[col.field]" filterPlaceholder="qq"
                            (onChange)="updateFiltering()"></p-dropdown> 
                        <p-calendar *ngSwitchCase="col.field === 'journee_exploitation'" 
                            [showTime]="false"  [showButtonBar]="true" 
                            dateFormat="dd/mm/yy" 
                            [monthNavigator]="true" [yearNavigator]="true" yearRange="2000:2030"
                            (onSelect)="updateFiltering()" (onClearClick)="updateFiltering()"
                            appendTo="body" [locale]="translationForPrimengCalendar" 
                            [(ngModel)]="filterValues[col.field]" 
                            ></p-calendar>
                        <p-dropdown *ngSwitchCase="col.field === 'sens_parcours'" 
                            [options]="allerRetourSelectItems" appendTo="body"
                            [(ngModel)]="filterValues[col.field]" filterPlaceholder="qq"
                            (onChange)="updateFiltering()"></p-dropdown> 
                        <p-checkbox *ngSwitchCase="col.field === 'nb_anomalies_retard' 
                                                || col.field === 'somme_valeurs_moins_seuil_retard' 
                                                || col.field === 'nb_situations_inacceptables_retard' 
                                                || col.field === 'nb_anomalies_avance'
                                                || col.field === 'somme_valeurs_moins_seuil_avance'
                                                || col.field === 'nb_situations_inacceptables_avance'
                                                || col.field === 'nb_anomalies_manque_de_regularite'
                                                || col.field === 'somme_valeurs_moins_seuil_manque_de_regularite'
                                                || col.field === 'nb_situations_inacceptables_manque_de_regularite'
                                                || col.field === 'nb_anomalies_absence_terminus_depart'
                                                || col.field === 'nb_anomalies_absence_terminus_arrivee'
                                                || col.field === 'nb_anomalies_aucun_arret'"  
                            [(ngModel)]="filterValues[col.field]" (onChange)="updateFiltering()" 
                            [binary]="true"></p-checkbox> 
                        <p-dropdown *ngSwitchCase="col.field === 'verifiee'" 
                            [options]="trueFalseSelectItems" appendTo="body"
                            [(ngModel)]="filterValues[col.field]" filterPlaceholder="qq"
                            (onChange)="updateFiltering()"></p-dropdown> 
                        
                    </th>
                    <th *ngIf="!col.filterable" ></th>
                </ng-container>                
            </ng-container>
        </tr>
    </ng-template>        
    <!-- Values -->
    <ng-template pTemplate="body" let-rowData let-columns="columns">        
        <tr [pSelectableRow]="rowData"> 
            <ng-container  *ngFor="let col of columns" >
                <ng-container *ngIf="col.columnIsDisplayed" >
                    <td [ngSwitch]="col.field">                        
                        <span *ngSwitchDefault>{{rowData[col.nameInSelect]}}</span>   
                        <span *ngSwitchCase="'carrier_contact'">{{rowData[col.nameInSelect] | getTranslation}}</span>
                        <span *ngSwitchCase="'ref_time'">{{rowData[col.nameInSelect] | date:'dd/MM/yyyy HH:mm'}}</span>
                        <p-checkbox *ngSwitchCase="'verifiee'"  
                            (onChange)="toggleCourseVerifiee($event,rowData)" 
                            [(ngModel)]="rowData[col.nameInSelect]"
                            [binary]="true"></p-checkbox> 
                        <button pButton icon="fas fa-eye" *ngSwitchCase="'view_details'" 
                            ></button>
                      
                    </td>
                </ng-container>                
            </ng-container>            
        </tr>
    </ng-template>
    
</p-table>

